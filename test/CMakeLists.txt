add_dependencies(check exec)

message(STATUS "Looking for lit")
find_program(LIT_EXECUTABLE
  NAMES lit
  PATHS ENV LIT_PATH)
if (LIT_EXECUTABLE)
  set(LIT_FOUND 1)
  message(STATUS "Looking for lit -- found")
endif()

if(LIT_FOUND)
  set(EAR_LIB_FILE ${CMAKE_SHARED_LIBRARY_PREFIX}ear${CMAKE_SHARED_LIBRARY_SUFFIX})
  set(BEAR_EXE ${CMAKE_BINARY_DIR}/source/bear/bear)
  set(INTERCEPT_EXE ${CMAKE_BINARY_DIR}/source/intercept/intercept)
  set(INTERCEPT_CC_EXE ${CMAKE_BINARY_DIR}/source/intercept-cc/intercept-cc)
  set(EAR_LIB ${CMAKE_BINARY_DIR}/source/libexec/${EAR_LIB_FILE})

  add_test(NAME func_test
    COMMAND lit -DEAR_EXE=${BEAR_EXE} -DINTERCEPT_EXE=${INTERCEPT_EXE} -DEAR_LIB=${EAR_LIB} -v ${CMAKE_CURRENT_SOURCE_DIR})
endif()
